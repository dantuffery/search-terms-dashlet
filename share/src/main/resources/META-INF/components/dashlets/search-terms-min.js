(function(){var h=YAHOO.util.Dom,i=YAHOO.util.Event;Ixxus.dashlet.SearchTerms=function e(k){Ixxus.dashlet.SearchTerms.superclass.constructor.call(this,"Ixxus.dashlet.SearchTerms",k,["button","container"]);return this};YAHOO.extend(Ixxus.dashlet.SearchTerms,Ixxus.component.Base,{options:{searchScope:"all",showAdminToolbar:false},dateRange:28,userSearch:false,maxItems:"100",zeroResults:false,displayCount:false,onReady:function j(){var q=this,p,o,m,l,k,n;this.widgets.searchScope=new YAHOO.widget.Button(this.id+"-search-scope",{type:"split",menu:q.id+"-search-scope-menu",lazyloadmenu:false});p=this.widgets.searchScope.getMenu();p.subscribe("click",function(s,r){var t=r[1];if(t){q.widgets.searchScope.set("label",t.cfg.getProperty("text"));q.onFilterChanged.call(q,r[1],"searchScope")}});this.widgets.dateRange=new YAHOO.widget.Button(this.id+"-range",{type:"split",menu:q.id+"-range-menu",lazyloadmenu:false});o=this.widgets.dateRange.getMenu();o.subscribe("click",function(s,r){var t=r[1];if(t){q.widgets.dateRange.set("label",t.cfg.getProperty("text"));q.onFilterChanged.call(q,r[1],"dateRange")}});this.widgets.maxItems=new YAHOO.widget.Button(this.id+"-max-items",{type:"split",menu:q.id+"-max-items-menu",lazyloadmenu:false});m=this.widgets.maxItems.getMenu();m.subscribe("click",function(s,r){var t=r[1];if(t){q.widgets.maxItems.set("label",t.cfg.getProperty("text"));q.onFilterChanged.call(q,r[1],"maxItems")}});l=h.get(this.id+"-user-search");i.addListener(l,"click",this.onCheckboxClicked,"userSearch",this);if(this.options.showAdminToolbar){k=h.get(this.id+"-display-count");i.addListener(k,"click",this.onCheckboxClicked,"displayCount",this);n=h.get(this.id+"-zero-results");i.addListener(n,"click",this.onCheckboxClicked,"zeroResults",this)}else{this.options.displayCount=false}this.loadSearchTerms()},loadSearchTerms:function a(){var l=this,m;m=function k(r){var q,o=r.json,p,n;if(typeof o.searchTerms!=="undefined"){q=o.searchTerms;p=new Ixxus.module.TagCloud(l.id+"-tag-cloud");p.setOptions({results:q,tagUri:l._getSearchTermURI(),tagUriSuffix:l._getSearchTermURISuffix(),tagCloudContainerId:l.id+"-search-terms",noTagsFoundMessage:l.msg("label.noSearchTerms"),displayCount:l.displayCount});p.generateTagCloud()}else{n='<label class="no-tags-msg">'+l.msg("label.failureMessage")+"</label>";h.get(l.id+"-search-terms").innerHTML=n}};Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI_RELATIVE+this._buildURI(),successCallback:{fn:m,scope:this}})},onFilterChanged:function g(m,k){var l=m.value;if(k==="searchScope"){this.options.searchScope=l}else{if(k==="dateRange"){this.dateRange=l}else{if(k==="maxItems"){this.maxItems=l}}}this.loadSearchTerms()},onCheckboxClicked:function c(l,k){if(k==="userSearch"){this.userSearch=!this.userSearch}else{if(k==="zeroResults"){this.zeroResults=!this.zeroResults}else{if(k==="displayCount"){this.displayCount=!this.displayCount}}}this.loadSearchTerms()},_getSearchTermURI:function b(){var k="";if(this.options.searchScope!=="all"&&this.options.searchScope!=="repo"&&this.options.searchScope!=="allSites"){k=Alfresco.constants.URL_CONTEXT+"page/site/"+this.options.searchScope+"/search?t="}else{k=Alfresco.constants.URL_CONTEXT+"page/search?t="}return k},_getSearchTermURISuffix:function d(){var k="";if(this.options.searchScope==="allSites"){k="&a=true&r=false"}else{if(this.options.searchScope==="repo"){k="&a=true&r=true"}}return k},_buildURI:function f(){var k=YAHOO.lang.substitute("search/search-terms/{searchScope}/{dateRange}/{userSearch}/{maxItems}/{zeroResults}",{searchScope:encodeURIComponent(this.options.searchScope),dateRange:this.dateRange,userSearch:encodeURIComponent(this.userSearch),maxItems:this.maxItems,zeroResults:encodeURIComponent(this.zeroResults)});return k}})})();